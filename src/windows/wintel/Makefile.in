# Makefile for the Kerberos for Windows telnet client
# Works for both k4 and k5 releases.
#
OBJS 	 = telnet.obj negotiat.obj auth.obj edit.obj emul.obj \
	   font.obj intern.obj screen.obj encrypt.obj genget.obj

##### Options
DEBUG 	 = 1
!IF ! defined(KVERSION)
KRBOPT=-DFORWARD -DAUTHENTICATION -DENCRYPTION -DDES_ENCRYPTION
KVERSION = 5
!endif
KRB 	 = KRB$(KVERSION)

###WIN16##WLIB	 = $(BUILDTOP)\lib\winsock.lib

BUILDTOP =..\..
INCLUDES = /I$(BUILDTOP)\include /I$(BUILDTOP)\include\krb5 \
	   /I$(BUILDTOP)\lib\crypto\des
##WIN16##XOBJS    = k5stream.obj enc_des.obj
##WIN32##XOBJS    = resource.obj k5stream.obj enc_des.obj

!if defined(DEBUG)
CFLAGS 	 = $(CCOPTS2) $(INCLUDES) /D$(KRB)=1 $(KRBOPT) /Zi
!else
CFLAGS 	 = $(CCOPTS2) $(INCLUDES) /D$(KRB)=1 $(KRBOPT)
!endif

#RFLAGS 	 = /D$(KRB)=1 $(INCLUDES) $(KRBOPT)
RFLAGS 	 = -D$(KRB)=1 $(KRBOPT)


##### Linker
LINK 	 = link
LIBS 	 = $(KLIB) $(WLIB)
##WIN16##SYSLIBS  = libw llibcew commdlg winsock
##WIN32##SYSLIBS  = libc.lib kernel32.lib wsock32.lib user32.lib gdi32.lib \
##WIN32##	  comdlg32.lib
!if defined(DEBUG)
##WIN16##LFLAGS = /co /nologo /nod /nopackcode /map:full
##WIN32##LFLAGS = /nologo /nod /debug
!else
##WIN16##LFLAGS = /nologo /nod /nopackcode
##WIN32##LFLAGS	= /nologo /nod
!endif

all:: makefile telnet.exe

telnet.exe: $*.def $*.res $(OBJS) $(XOBJS) $(LIBS)
##WIN16##	$(LINK) $(LFLAGS) $(OBJS) $(XOBJS), $@, $*.map, \
##WIN16##	  $(LIBS) $(SYSLIBS), $*.def
##WIN16##	$(RC) $(RFLAGS) /k telnet.rc $@
##WIN32##	$(LINK) $(LFLAGS) /map:$*.map /out:$@ $(OBJS) $(XOBJS) \
##WIN32##	  $(LIBS) $(SYSLIBS)

##WIN32##telnet.res: telnet.rc
##WIN32##	$(RC) $(RFLAGS) /r $*.rc
##WIN32##resource.obj: telnet.res
##WIN32##	$(CVTRES) /nologo /out:resource.obj telnet.res

install::
	copy telnet.exe $(DESTDIR)

clean:: 
	$(RM) *.exe *.res *.map
