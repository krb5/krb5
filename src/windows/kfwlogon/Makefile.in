# Makefile for the KFW Network Provider
#

thisconfigdir=./..
myfulldir=windows/nplogon
mydir=.
BUILDTOP=$(REL)..$(S)..
DEFINES = 
LOCALINCLUDES = -I$(BUILDTOP) -I$(PISMERE)\athena\util\loadfuncs \
	-I$(PISMERE)\athena\auth\krb5\src\include\kerberosIV \
	-I$(PISMERE)\athena\auth\krb4\include \
	-I$(PISMERE)\athena\auth\leash\include
PROG_LIBPATH=-L$(TOPLIBD) -L$(KRB5_LIBDIR)

SYSLIBS = kernel32.lib user32.lib advapi32.lib wsock32.lib secur32.lib
RFLAGS = $(LOCALINCLUDES)
RCFLAGS = $(RFLAGS) -D_WIN32

all-windows:: $(OUTPRE)kfwlogon.dll $(OUTPRE)kfwcpcc.exe

$(OUTPRE)kfwlogon.res: kfwlogon.rc ..\version.rc

$(OUTPRE)kfwcpcc.res: kfwcpcc.rc ..\version.rc

$(OUTPRE)kfwlogon.dll: $(OUTPRE)kfwlogon.obj $(OUTPRE)kfwcommon.obj $(OUTPRE)kfwlogon.res
    link $(DLL_LINKOPTS) -out:$@ $(OUTPRE)kfwlogon.obj $(OUTPRE)kfwcommon.obj -entry:DllEntryPoint -def:kfwlogon.def $(SYSLIBS) $(KLIB) $(CLIB) $(SCLIB)

$(OUTPRE)kfwcpcc.exe: $(OUTPRE)kfwcpcc.obj $(OUTPRE)kfwcommon.obj $(OUTPRE)kfwcpcc.res
    link $(EXE_LINKOPTS) -out:$@ $(OUTPRE)kfwcpcc.obj $(OUTPRE)kfwcommon.obj $(SYSLIBS) $(KLIB) $(CLIB) $(SCLIB)

install::
        copy $(OUTPRE)kfwlogon.dll $(DESTDIR)
        copy $(OUTPRE)kfwcpcc.exe  $(DESTDIR)

clean::
        $(RM) $(OUTPRE)*.exe $(OUTPRE)*.dll $(OUTPRE)*.res

