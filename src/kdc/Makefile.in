CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)
PROG_LIBPATH=-L$(TOPLIBD) $(KRB4_LIBPATH)
PROG_RPATH=$(KRB5_LIBDIR)

all:: krb5kdc

DEFINES = -DBACKWARD_COMPAT $(KRB4DEF)

LOCALINCLUDE = @KRB4_INCLUDES@ -I.
SRCS= \
	kdc5_err.c \
	$(srcdir)/dispatch.c \
	$(srcdir)/do_as_req.c \
	$(srcdir)/do_tgs_req.c \
	$(srcdir)/kdc_util.c \
	$(srcdir)/kdc_preauth.c \
	$(SRCTOP)/lib/kadm5/logger.c \
	$(srcdir)/main.c \
	$(srcdir)/network.c \
	$(srcdir)/policy.c \
	$(srcdir)/extern.c \
	$(srcdir)/replay.c \
	$(srcdir)/kerberos_v4.c

OBJS= \
	kdc5_err.o \
	dispatch.o \
	do_as_req.o \
	do_tgs_req.o \
	kdc_util.o \
	kdc_preauth.o \
	logger.o \
	main.o \
	network.o \
	policy.o \
	extern.o \
	replay.o \
	kerberos_v4.o

depend:: kdc5_err.c

logger.c: $(SRCTOP)/lib/kadm5/logger.c
	$(RM) $@
	$(CP) $(SRCTOP)/lib/kadm5/logger.c $@

logger.o: logger.c

kdc5_err.c: kdc5_err.et

kdc5_err.h: kdc5_err.et

kdc5_err.o: kdc5_err.h

krb5kdc: $(OBJS) $(KADMSRV_DEPLIBS) $(KRB4COMPAT_DEPLIBS)
	$(CC_LINK) -o krb5kdc $(OBJS) $(KADMSRV_LIBS) $(KRB4COMPAT_LIBS)

install::
	$(INSTALL_PROGRAM) krb5kdc ${DESTDIR}$(SERVER_BINDIR)/krb5kdc
	$(INSTALL_DATA) $(srcdir)/krb5kdc.M ${DESTDIR}$(SERVER_MANDIR)/krb5kdc.8

clean::
	$(RM) kdc5_err.h kdc5_err.c krb5kdc logger.c

