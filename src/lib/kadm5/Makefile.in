CFLAGS = $(CCOPTS) $(DEFS)

##DOSBUILDTOP = ..\..

.c.o:
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c
@SHARED_RULE@

kadm_err.$(OBJEXT): kadm_err.c
	$(CC) $(CFLAGS) -c $*.c
@SHARED_RULE_LOCAL@

adb_err.$(OBJEXT): adb_err.c
	$(CC) $(CFLAGS) -c $*.c
@SHARED_RULE_LOCAL@

chpass_util_strings.$(OBJEXT): chpass_util_strings.c
	$(CC) $(CFLAGS) -c $*.c
@SHARED_RULE_LOCAL@

kadm_err.c kadm_err.h: $(srcdir)/kadm_err.et
adb_err.c adb_err.h: $(srcdir)/adb_err.et
chpass_util_strings.c chpass_util_strings.h: $(srcdir)/chpass_util_strings.et

clean::
	$(RM) kadm_err.c kadm_err.h kadm_err.o
	$(RM) adb_err.c adb_err.h adb_err.o
	$(RM) chpass_util_strings.c chpass_util_strings.h chpass_util_strings.o

SRCS =	kadm_err.c \
	adb_err.c \
	chpass_util_strings.c \
	$(srcdir)/ovsec_glue.c \
	$(srcdir)/misc_free.c \
	$(srcdir)/kadm_rpc_xdr.c \
	$(srcdir)/chpass_util.c \
	$(srcdir)/alt_prof.c \
	$(srcdir)/str_conv.c \
	$(srcdir)/logger.c

OBJS =	kadm_err.$(OBJEXT) \
	adb_err.$(OBJEXT) \
	chpass_util_strings.$(OBJEXT) \
	ovsec_glue.$(OBJEXT) \
	misc_free.$(OBJEXT) \
	kadm_rpc_xdr.$(OBJEXT) \
	chpass_util.$(OBJEXT) \
	alt_prof.$(OBJEXT) \
	str_conv.$(OBJEXT) \
	logger.$(OBJEXT)

HDRDIR=$(BUILDTOP)/include/kadm5
HDRS =	$(HDRDIR)/adb.h \
	$(HDRDIR)/admin.h \
	$(HDRDIR)/admin_internal.h \
	$(HDRDIR)/admin_xdr.h \
	$(HDRDIR)/kadm_rpc.h \
	$(HDRDIR)/server_internal.h \
	$(HDRDIR)/adb_err.h \
	$(HDRDIR)/chpass_util_strings.h \
	$(HDRDIR)/kadm_err.h

$(OBJS): $(HDRS) shared

all-unix:: $(OBJS) DONE
all-mac:: $(OBJS)
all-windows:: $(OBJS)

shared:
	mkdir shared

check-windows::

clean-unix::
	$(RM) shared/*
	-rmdir shared

clean-mac::
clean-windows::

all-recurse: $(OBJS) DONE
