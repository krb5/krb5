CFLAGS = $(CCOPTS) $(DEFS)
KRB5_RUN_ENV = @KRB5_RUN_ENV@

all:: $(OBJS)

SRCS= \
	$(srcdir)/keytab.c \
	$(srcdir)/encrypt_key.c \
	$(srcdir)/decrypt_key.c \
	$(srcdir)/kdb_cpw.c \
	$(srcdir)/kdb_dbm.c \
	$(srcdir)/kdb_xdr.c \
	$(srcdir)/verify_mky.c \
	$(srcdir)/fetch_mkey.c \
	$(srcdir)/setup_mkey.c \
	$(srcdir)/store_mkey.c

OBJS= \
	keytab.o \
	encrypt_key.o \
	decrypt_key.o \
	kdb_cpw.o \
	kdb_dbm.o \
	kdb_xdr.o \
	verify_mky.o \
	fetch_mkey.o \
	setup_mkey.o \
	store_mkey.o

libkdb5.a: $(OBJS)
	$(RM) $@
	$(ARADD) $@ $(OBJS)
	$(RANLIB) $@

install:: libkdb5.a
	$(INSTALL_DATA) libkdb5.a $(DESTDIR)$(KRB5_LIBDIR)/libkdb5.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libkdb5.a

clean::
	$(RM) libkdb5.a

t_kdb:	t_kdb.o $(DEPLIBS)
	$(LD) $(LDFLAGS) $(LDARGS) -o t_kdb t_kdb.o $(LIBS)

check::	t_kdb
	$(KRB5_RUN_ENV) ./t_kdb

clean::
	$(RM) t_kdb t_kdb.o
