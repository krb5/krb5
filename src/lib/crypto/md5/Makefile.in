CFLAGS = $(CCOPTS) $(DEFS) -I$(srcdir)/../des

##DOSBUILDTOP = ..\..\..
##DOSMYNAME=md5
##DOSOBJFILE=..\md5.lst
##WIN16##LIBNAME=..\crypto.lib

RUN_SETUP = @KRB5_RUN_ENV@
.c.o:
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c
@SHARED_RULE@

OBJS=	md5.$(OBJEXT) md5glue.$(OBJEXT) md5crypto.$(OBJEXT)

SRCS=	$(srcdir)/md5.c $(srcdir)/md5glue.c $(srcdir)/md5crypto.c

all-unix:: shared $(OBJS) 
all-mac:: shared $(OBJS) 
all-windows:: $(OBJFILE)

##DOS$(OBJFILE): $(OBJS)
##DOS	$(RM) $(OBJFILE)
##WIN16##	$(CP) nul: $(OBJFILE)
##WIN32##	$(LIBECHO) -p $(MYNAME)\ *.obj > $(OBJFILE)

shared:
	mkdir shared

t_mddriver: t_mddriver.o md5.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o t_mddriver t_mddriver.o md5.o

t_mddriver.exe:
	$(CC) $(CFLAGS2) -o t_mddriver.exe t_mddriver.c md5.c

t_cksum: t_cksum.o $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a
	$(CC) $(CFLAGS) -o t_cksum t_cksum.o $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(LIBS)

check-unix:: t_mddriver t_cksum
	$(RUN_SETUP) $(C)t_mddriver -x
	$(RUN_SETUP)  $(C)t_cksum "this is a test"

check-windows:: t_mddriver$(EXEEXT)
	$(C)t_mddriver$(EXEEXT) -x

clean:: 
	$(RM) t_mddriver$(EXEEXT) t_mddriver.$(OBJEXT)
	$(RM) t_cksum$(EXEEXT) t_cksum.$(OBJEXT)

clean-unix::
	$(RM) shared/*
clean-mac::
	$(RM) shared/*
clean-windows::
	$(RM) $(OBJFILE)
